(()=>{"use strict";var e={n:t=>{var o=t&&t.__esModule?()=>t.default:()=>t;return e.d(o,{a:o}),o},d:(t,o)=>{for(var n in o)e.o(o,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:o[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=jQuery;var o=e.n(t);const n=["id","class","style","title","accesskey","tabindex","lang","dir","draggable","dropzone","contextmenu","hidden"].join("|"),r=["onclick"].join("|");async function a(e){return new Promise((t=>{setTimeout((function o(){const n=e();n?Promise.resolve(n).then(t):setTimeout(o,100)}))}))}const i=[];(async()=>{const e=document.querySelectorAll("#convert_breaks, #convert_breaks_for_mobile");(async function(e){const t=[...document.querySelectorAll("#editor-input-content, #editor-input-extended")];let s="";const c=t.map((e=>{let t=null;const o=document.createElement("textarea");o.id=e.id+"-mt-be";const c=document.createElement("div");return c.classList.add("mt-block-editor-wrap-entry"),c.appendChild(o),i.push((async()=>{if(t)return t.serialize().then((()=>{e.value=o.value}))})),async i=>{const d=s;if(s=i,"block_editor"===i){await a((()=>e.closest(".mt-editor-manager-wrap"))),o.value=e.value,e.closest(".mt-editor-manager-wrap")?.appendChild(c);const i=document.querySelector(`#editor-header .tab[mt\\:command="set-editor-${e.id.replace(/.*-/,"")}"] a`).textContent||"",s={id:o.id,mode:"composition",rootAttributes:{"data-field-name":i}};return function(e,t){const o=document.getElementById("mt-block-editor-loader"),n=o?.dataset;if(!n)return;const r=JSON.parse(n.mtBlockDisplayOptionsMap||"{}")[e]||null;let a=[],i=[];if(r){const e=JSON.parse(r),t=JSON.parse(n.mtBlockTypeIds||"[]");e.common.forEach((e=>{const o=t.indexOf(e.typeId);-1!==o&&t.splice(o,1),e.shortcut&&i.push(e.typeId),e.panel&&a.push(e.typeId)})),a.push(...t)}else a=JSON.parse(n.mtBlockTypeIds||"[]"),i=a.slice(0,parseInt(n.mtBlockEditorShortcutCountDefault||"",10));Object.assign(t,{panelBlockTypes:a,shortcutBlockTypes:i})}(document.getElementById("text-be_config").value,s),function(e){const t=window.MT?.Editor?.defaultCommonOptions||{};if(t.content_css_list&&(e.stylesheets=t.content_css_list),t.body_class_list){const o=t.body_class_list.filter((e=>"wysiwyg"!==e));e.rootClassName=o.join(" ")}}(s),window.MTBlockEditor&&window.MTBlockEditor.isSupportedEnvironment()?t=await function(e){function t({editor:e}){window.setDirty&&window.setDirty(!0),window.app&&window.app.getIndirectMethod("setDirty")(),e.off("change",t)}const o={i18n:{lng:document.querySelector("html")?.getAttribute("lang")},block:{"sixapart-oembed":{resolver:async({url:e,maxwidth:t,maxheight:o})=>{const n=await(await fetch(window.CMSScriptURI+"?"+new URLSearchParams({__mode:"mt_be_oembed",url:e,maxwidth:t||"",maxheight:o||""}))).json();if(n.error?.message)throw new Error(n.error.message);return n}}}},a="tinyMCEDefaultSettings"in e?e.tinyMCEDefaultSettings:{convert_urls:!1,entities:"160,nbsp",entity_encoding:"named",valid_children:"+a[video|ul|time|table|svg|style|section|ruby|progress|pre|output|ol|noscript|nav|meter|meta|menu|mark|link|keygen|hr|hgroup|header|h6|h5|h4|h3|h2|h1|form|footer|figure|fieldset|embed|dl|div|dialog|details|datalist|command|canvas|blockquote|audio|aside|article|address|area]"},i=Object.assign({},o.block,e.block||{}),s=Object.assign({},o,e,{block:i});return s.stylesheets=s.stylesheets||[],window.MTBlockEditor?.apply(s).then((e=>{e.on("buildTinyMCESettings",(({settings:e})=>{Object.assign(e,a),e.extended_valid_elements=[`a[${n}|${r}|href|target|name]`,`span[${n}|${r}]`,"script[id|name|type|src|integrity|crossorigin]"].join(",")})),e.on("change",t);const o=document.getElementById("mt-block-editor-loader"),i=o?.dataset?.mtBlockEditorIframeBaseUrl;return i&&e.on("beforeRenderIframePreview",(e=>{const t=document.createElement("base");t.href=i,e.head=t.outerHTML+e.head})),e}))}(s):c.innerHTML=`\n          <div class="card m-5"><div class="card-body">\n          ${window.trans("This format does not support this web browser. Please switch to another format.")}\n          </div></div>\n          `,await a((()=>e.closest(".mt-editor-manager-wrap")?.querySelector(".tox-tinymce"))),void e.closest(".mt-editor-manager-wrap")?.querySelector(".tox-tinymce")?.classList.add("d-none")}var l;"block_editor"===d&&(await(l={id:o.id},window.MTBlockEditor?window.MTBlockEditor.unload(l):Promise.resolve()),t=null,e.value=o.value,c.remove(),e.closest(".mt-editor-manager-wrap")?.querySelector(".tox-tinymce")?.classList.remove("d-none"))}}));e.forEach((e=>{e.addEventListener("change",(t=>{t.isTrusted&&(t.stopImmediatePropagation(),t.stopPropagation(),t.preventDefault(),Promise.all(c.map((t=>t(e.value)))).then((()=>{o()(e).trigger("change")})))}))})),c.forEach((t=>t(e[0].value)))})(e),e[0].form?.querySelectorAll('button[type="submit"]').forEach((e=>{!function(e,t){let o=!1;e.addEventListener("click",(n=>{o?o=!1:(n.stopImmediatePropagation(),n.stopPropagation(),n.preventDefault(),Promise.all(t.map((e=>e()))).then((()=>{o=!0,e.click()})))}),{capture:!0})}(e,i)}))})()})();